@{
    ViewData["Title"] = "Home Page";
}

<div class="container mt-3">
    <div class="row row-cols-1 row-cols-md-3 g-4" id="templateContainer">
        @foreach (var template in Model)
        {
            <partial name="_TemplateCardPartial" model="template" />
        }
    </div>
</div>

<div id="loading" class="text-center my-3" style="display: none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

<script>
    let page = 1;
    let isLoading = false;

    window.addEventListener("scroll", async function () {
        if (isLoading) return;

        let scrollPosition = window.innerHeight + window.scrollY;
        let documentHeight = document.body.offsetHeight;

        if (scrollPosition >= documentHeight - 200) {
            isLoading = true;
            document.getElementById("loading").style.display = "block";

            try {
                let response = await fetch(`/Home/LoadMoreTemplates?page=${page}`);
                if (response.ok) {
                    let html = await response.text();
                    document.getElementById("templateContainer").insertAdjacentHTML("beforeend", html);
                    page++;
                }
            } catch (error) {
                console.error("Error loading templates:", error);
            }

            document.getElementById("loading").style.display = "none";
            isLoading = false;
        }
    });
</script>
